---
name: chatpicking
description: "QQç¾¤èŠæ¶ˆæ¯æ‰«æä¸æ€»ç»“skillã€‚é€šè¿‡NapCat (OneBot v11)è¿æ¥QQï¼Œæ”¶é›†æŒ‡å®šç¾¤çš„èŠå¤©æ¶ˆæ¯å¹¶è¾“å‡ºç»“æ„åŒ–æ•°æ®ä¾›LLMæ€»ç»“ã€‚ä½¿ç”¨åœºæ™¯ï¼š(1) æ‹‰å–QQç¾¤å†å²æ¶ˆæ¯è¿›è¡Œæ€»ç»“ (2) å®æ—¶ç›‘å¬QQç¾¤æ¶ˆæ¯ä¸€æ®µæ—¶é—´åç”Ÿæˆæ‘˜è¦ (3) å®šæ—¶cronä»»åŠ¡è‡ªåŠ¨é‡‡é›†ç¾¤èŠå¹¶è¾“å‡ºæ€»ç»“ã€‚éœ€è¦é¢„å…ˆéƒ¨ç½²NapCatã€‚"
metadata:
  openclaw:
    emoji: "ğŸ’¬"
    requires:
      bins: [node]
---

# Chatpicking â€” QQ ç¾¤èŠæ¶ˆæ¯æ‰«æä¸æ€»ç»“

é€šè¿‡ NapCat (OneBot v11 åè®®) è¿æ¥ QQï¼Œé‡‡é›†æŒ‡å®šç¾¤çš„èŠå¤©æ¶ˆæ¯ï¼Œè¾“å‡ºç»“æ„åŒ– JSON æ•°æ®ä¾› LLM è§£è¯»å’Œæ€»ç»“ã€‚

## å‰ç½®è¦æ±‚

- **Node.js** â‰¥ 18
- **NapCat** å·²å®‰è£…å¹¶è¿è¡Œï¼Œé…ç½®äº† OneBot v11 WebSocket æœåŠ¡
  - å®‰è£…æŒ‡å—ï¼šhttps://napneko.github.io/
  - éœ€è¦åœ¨ NapCat ä¸­é…ç½® WebSocket ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ 3001ï¼‰

### é¦–æ¬¡å®‰è£…ä¾èµ–

```bash
cd {baseDir} && npm install
```

## å‘½ä»¤

### æ‹‰å–ç¾¤èŠå†å²æ¶ˆæ¯

```bash
# æ‹‰å–æœ€è¿‘ 100 æ¡æ¶ˆæ¯ï¼ˆé»˜è®¤ï¼‰
node {baseDir}/scripts/fetch.mjs --napcat ws://127.0.0.1:3001 --group <ç¾¤å·>

# æ‹‰å–æŒ‡å®šæ•°é‡
node {baseDir}/scripts/fetch.mjs --napcat ws://127.0.0.1:3001 --group <ç¾¤å·> --count 200

# ä½¿ç”¨ access_token
node {baseDir}/scripts/fetch.mjs --napcat ws://127.0.0.1:3001 --group <ç¾¤å·> --token <token>
```

### å®æ—¶ç›‘å¬ç¾¤æ¶ˆæ¯

```bash
# ç›‘å¬ 60 åˆ†é’Ÿï¼ˆé»˜è®¤ï¼‰
node {baseDir}/scripts/collect.mjs --napcat ws://127.0.0.1:3001 --group <ç¾¤å·>

# ç›‘å¬æŒ‡å®šæ—¶é•¿
node {baseDir}/scripts/collect.mjs --napcat ws://127.0.0.1:3001 --group <ç¾¤å·> --duration 30
```

**æ³¨æ„**ï¼š`collect.mjs` ä¼šé˜»å¡è¿è¡Œç›´åˆ°æ—¶é—´ç»“æŸï¼Œè¿›åº¦ä¿¡æ¯è¾“å‡ºåˆ° stderrï¼Œæœ€ç»ˆ JSON ç»“æœè¾“å‡ºåˆ° stdoutã€‚

## ä½¿ç”¨æµç¨‹

1. **æ¥æ”¶ç”¨æˆ·è¯·æ±‚** â†’ åˆ¤æ–­æ˜¯æ‹‰å–å†å²æ¶ˆæ¯è¿˜æ˜¯å®æ—¶ç›‘å¬
2. **è¿è¡Œè„šæœ¬** â†’ æ‰§è¡Œå¯¹åº”å‘½ä»¤è·å– JSON æ•°æ®
3. **è§£è¯»ç»“æœ** â†’ å¯¹ JSON ä¸­çš„æ¶ˆæ¯åˆ—è¡¨è¿›è¡Œæ€»ç»“ï¼Œæå–å…³é”®è¯é¢˜ã€é‡è¦ä¿¡æ¯ã€è®¨è®ºè¶‹åŠ¿

## ä½¿ç”¨åœºæ™¯å¯¹ç…§

| ç”¨æˆ·è¯·æ±‚ | æ¨èå‘½ä»¤ |
|----------|----------|
| "å¸®æˆ‘çœ‹çœ‹XXç¾¤æœ€è¿‘èŠäº†å•¥" | `fetch.mjs --group <ç¾¤å·> --count 100` |
| "æ€»ç»“XXç¾¤ä»Šå¤©çš„æ¶ˆæ¯" | `fetch.mjs --group <ç¾¤å·> --count 500` |
| "ç›‘å¬XXç¾¤æ¥ä¸‹æ¥åŠå°æ—¶çš„æ¶ˆæ¯" | `collect.mjs --group <ç¾¤å·> --duration 30` |
| "æ¯å¤©æ€»ç»“XXç¾¤çš„æ¶ˆæ¯" | cron: `fetch.mjs --group <ç¾¤å·> --count 500` |

## è¾“å‡ºæ ¼å¼

ä¸¤ä¸ªè„šæœ¬è¾“å‡ºæ ¼å¼ç›¸åŒï¼š

```json
{
  "success": true,
  "group_id": "123456789",
  "fetched_count": 42,
  "fetch_time": "2026-02-15T10:30:00.000Z",
  "messages": [
    {
      "sender": "å¼ ä¸‰",
      "user_id": 10001,
      "time": "2026-02-15T09:15:00.000Z",
      "timestamp": 1771045200,
      "content": "å¤§å®¶æ—©ä¸Šå¥½"
    }
  ]
}
```

## æ€»ç»“æŒ‡å¯¼

æ”¶åˆ°æ¶ˆæ¯ JSON åï¼ŒæŒ‰ä»¥ä¸‹ç»´åº¦æ€»ç»“ï¼š

1. **æ ¸å¿ƒè¯é¢˜**ï¼šç¾¤é‡Œä¸»è¦è®¨è®ºäº†ä»€ä¹ˆä¸»é¢˜
2. **å…³é”®ä¿¡æ¯**ï¼šé‡è¦çš„é€šçŸ¥ã€å†³å®šã€é“¾æ¥
3. **æ´»è·ƒåº¦**ï¼šæ¶ˆæ¯å¯†åº¦ã€æ´»è·ƒæ—¶æ®µã€ä¸»è¦å‘è¨€äºº
4. **æƒ…ç»ªæ°›å›´**ï¼šæ•´ä½“è®¨è®ºæ°›å›´ï¼ˆå‹å¥½/äº‰è®º/æ—¥å¸¸é—²èŠï¼‰

## Cron ç¤ºä¾‹

### æ¯æ—¥ç¾¤èŠæ‘˜è¦

```
0 22 * * * node {baseDir}/scripts/fetch.mjs --group 123456789 --count 500
```

### æ¯å‘¨ç¾¤èŠæ€»ç»“

```
0 20 * * 0 node {baseDir}/scripts/fetch.mjs --group 123456789 --count 2000
```

## ç¯å¢ƒå˜é‡

å¯é€šè¿‡ç¯å¢ƒå˜é‡æ›¿ä»£å‘½ä»¤è¡Œå‚æ•°ï¼š

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | å¯¹åº”å‚æ•° |
|----------|------|----------|
| `NAPCAT_WS` | NapCat WebSocket åœ°å€ | `--napcat` |
| `NAPCAT_GROUP` | é»˜è®¤ç¾¤å· | `--group` |
| `NAPCAT_TOKEN` | OneBot access_token | `--token` |

## è„šæœ¬æ–‡ä»¶

- `scripts/fetch.mjs` â€” æ‹‰å–ç¾¤èŠå†å²æ¶ˆæ¯
- `scripts/collect.mjs` â€” å®æ—¶ç›‘å¬ç¾¤æ¶ˆæ¯å¹¶æ”¶é›†
